
# Chatty Microservices

**Chatty** — это учебная платформа в виде социальной сети, разработанная с использованием микросервисной архитектуры. 
Платформа предоставляет пользователям возможность создавать посты, делиться изображениями, ставить лайки и комментировать публикации других участников.

## Архитектура

Проект состоит из следующих микросервисов:
1. auth_service - Аутентификация и авторизация 
2. admin_service - Управление пользователями и административная панель 
3. posts_service - Посты, комментарии, лайки
4. subscription_service - Подписки и формирование ленты новостей         
5. email_consumer - Отправка email-уведомлений через очередь       
6. nginx - Обратный прокси и маршрутизация запросов       


##  Подробное описание микросервисов

# **auth_service**
Сервис для аутентификации и авторизации пользователей, является частью распределённой архитектуры и 
взаимодействует с другими сервисами (например, posts_service, subscription_service, admin_service) через API 
и, при необходимости, через брокер сообщений (RabbitMQ).


Функции:
  - Регистрация новых пользователей
  - Вход по email и паролю
  - JWT-авторизация (генерация JWT токенов для дальнейшего использования)
  - Хэширование паролей (bcrypt)
  - Валидация с помощью Pydantic
  - Восстановление пароля (сброс пароля через email, отправка ссылки для восстановления пароля)


Технологии:
- FastAPI — web-фреймворк для создания REST API
- SQLAlchemy — ORM для работы с базой данных
- PostgreSQL / SQLite — база данных (в зависимости от окружения)
- Pydantic — для валидации данных
- JWT (JSON Web Tokens) — для аутентификации и авторизации
- Docker — контейнеризация сервиса (по желанию)

Настройте переменные окружения:
Создайте файл .env.local в корне auth_service и добавьте необходимые параметры:

DB_HOST=auth_db
DB_PORT=5432
DB_NAME=auth_db
DB_USER=postgres
DB_PASSWORD=postgres
SECRET_KEY=your-secret-key
DEBUG=True


---

### **admin_service**
Интерфейс и API для администраторов и модераторов.

Функции:
  - Просмотр списка пользователей
  - Бан/разбан пользователя
  - Управление статусами (активен, заблокирован, удалён)
  - Проверка статуса email

Технологии: FastAPI, PostgreSQL, RabbitMQ (для рассылок)

---

### **posts_service**
Сервис публикаций пользователей, является частью распределённой архитектуры и взаимодействует с другими
сервисами (например, auth_service, subscription_service, admin_service) через API и, при необходимости, через брокер сообщений (RabbitMQ)

Функции:
  - Создание и удаление постов
  - Прикрепление изображений
  - Добавление комментариев
  - Лайки (с ограничением одного лайка от пользователя)

Технологии:
- FastAPI — web-фреймворк для создания REST API
- SQLAlchemy — ORM для работы с базой данных
- PostgreSQL / SQLite — база данных (в зависимости от окружения)
- Pydantic — для валидации данных
- Alembic — для управления миграциями (если используется)
- Docker — контейнеризация сервиса (по желанию)

Настройте переменные окружения:
Создайте файл .env.local в корне post_service и добавьте необходимые параметры:

DB_HOST=post_db
DB_PORT=5432
DB_NAME=post_db
DB_USER=postgres
DB_PASSWORD=postgres
DEBUG=True


---

### **email_consumer**
Фоновый сервис для обработки email-уведомлений из очереди.

Функции:
  - Получение задач из RabbitMQ
  - Отправка писем (например, подтверждение регистрации)
  - Обработка ошибок при отправке

Технологии: Python, Pika, SMTP

---

### **subscription_service**
Микросервис подписок и формирования ленты новостей, 
является частью распределённой архитектуры и взаимодействует с другими сервисами 
(например, auth_service, posts_service, admin_service) через API и, при необходимости, через брокер сообщений (RabbitMQ).



Функции:
  - Подписка/отписка на пользователей
  - Получение списка подписок и подписчиков
  - Генерация ленты из постов на кого подписан пользователь
  - Кеширование ленты

Технологии: 
- FastAPI — web-фреймворк для создания REST API
- SQLAlchemy — ORM для работы с базой данных
- PostgreSQL / SQLite — база данных (в зависимости от окружения)
- Pydantic — для валидации данных
- Alembic — для управления миграциями (если используется)
- Docker — контейнеризация сервиса (по желанию)

Чтобы настроить переменные окружения:
Создайте файл .env.local в корне subscription_service и добавьте необходимые параметры:

DB_HOST=subscription_db
DB_PORT=5432
DB_NAME=subscription_db
DB_USER=postgres
DB_PASSWORD=postgres
DEBUG=True




---

### **nginx**
Обратный прокси-сервер, обеспечивающий маршрутизацию запросов ко всем микросервисам.

Функции:
  - Балансировка нагрузки
  - Перенаправление URL
  - Защита от прямого доступа к внутренним сервисам

Конфигурация:
Включает маршруты `/api/auth/`, `/api/posts/`, `/api/admin/` и другие.

---

## **Быстрый старт**

### Предварительные требования

- Docker и Docker Compose
- Python 3.9+ (для локальной разработки)

### **Установка и запуск**

```bash
git clone https://github.com/Tatiana-Iuranova/Chatty_Microservices.git
cd Chatty_Microservices
python -m venv .venv # создаем виртуальное окружение
cp .env.example .env.local  # настройте переменные окружения
docker-compose up -d --build # собираем контейнеры
``` 

Приложение будет доступно по адресу: [http://localhost](http://localhost)

Эндпоинты API subscription_service предоставляет следующие эндпоинты:

Подписки:
Метод  |  URL                        | Описание
-------------------------------------------------
GET    | /subscriptions/             | Получить список всех подписок
GET    | /subscriptions/{user_id}    | Получить подписки пользователя
POST   | /subscriptions/             | Создать новую подписку
DELETE | /subscriptions/{user_id}    | Отписаться от пользователя

Лента новостей:
Метод  |  URL                        | Описание
-------------------------------------------------
GET    | /newsfeed/{user_id}         | Получить ленту новостей для пользователя

Для работы этих эндпоинтов предполагается передача user_id в теле запроса или через токен.

Завершение:
Теперь, когда вы настроили и запустили subscription_service, вы можете интегрировать его с другими микросервисами системы, такими как posts_service для формирования ленты новостей и управления подписками.

---

## Тестирование

```bash
docker-compose -p docker-compose-test up -d --build
docker exec -it <имя контейнера> pytest
```

---

## **Используемые технологии**

- Python (FastAPI)
- PostgreSQL
- RabbitMQ
- Docker & Docker Compose
- Nginx
- SMTP (email)

---
